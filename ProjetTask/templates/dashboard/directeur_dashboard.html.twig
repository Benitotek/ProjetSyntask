{% extends 'base.html.twig' %}

{% block title %}Dashboard Directeur - SYNTASK
{% endblock %}
{% block stylesheets %}
	{{ parent() }}
	<link rel="stylesheet" href="{{ asset('styles/directeur.css') }}">
{% endblock %}
{% block body %}
	 <!-- Header avec logo -->
    <header class="app-header">
        <div class="logo-section">
            <div class="app-logo">
                <svg class="logo-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                    <circle cx="9" cy="9" r="2"/>
                    <path d="m21 15-3.086-3.086a2 2 0 0 0-1.414-.586H14l-2.5 2.5"/>
                    <path d="M9 18h6"/>
                </svg>
                <span class="app-name">SYNTASK</span>
            </div>
        </div>
    </header>
    <div class="dashboard-layout">
        <!-- Sidebar gauche -->
        <aside class="sidebar">
            <!-- Profil utilisateur -->
            <div class="user-profile">
                <div class="profile-image">
                    <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iODAiIHZpZXdCb3g9IjAgMCA4MCA4MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iNDAiIGN5PSI0MCIgcj0iNDAiIGZpbGw9IiNGM0Y0RjYiLz4KPGNpcmNsZSBjeD0iNDAiIGN5PSIzMiIgcj0iMTIiIGZpbGw9IiM2QjcyODAiLz4KPHBhdGggZD0iTTIwIDY4QzIwIDU2IDI5IDQ2IDQwIDQ2UzYwIDU2IDYwIDY4IiBmaWxsPSIjNkI3MjgwIi8+Cjwvc3ZnPgo=" alt="Photo de profil">
                </div>
                <div class="user-info">
                    <span class="user-role">directeur</span>
                    <h3 class="user-name">Jean Dupont</h3>
                    <span class="user-position">Directeur Général</span>
                </div>
            </div>

            <!-- Navigation -->
            <nav class="sidebar-nav">
                <h4 class="nav-title">Tableaux de bord</h4>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="#" class="nav-link active">projects</a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link">Tâches</a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link">Rapports</a>
                    </li>
                </ul>
                <p class="nav-subtitle">différentes vues selon l'utilisateur</p>
            </nav>

            <!-- Bouton déconnexion -->
            <div class="logout-section">
                <button class="logout-btn">
                    <span>Déconnexion</span>
                </button>
            </div>
        </aside>

        <!-- Contenu principal -->
        <main class="main-content">
            <!-- Section résumé global -->
            <section class="summary-section">
                <h2 class="section-title">Résumé global</h2>
                <div class="summary-cards">
                    <div class="summary-card summary-card--active">
                        <span class="card-label">projects Actifs</span>
                        <span class="card-value">12</span>
                    </div>
                    <div class="summary-card summary-card--waiting">
                        <span class="card-label">En attente</span>
                        <span class="card-value">5</span>
                    </div>
                    <div class="summary-card summary-card--delayed">
                        <span class="card-label">En retard</span>
                        <span class="card-value">2</span>
                    </div>
                    <div class="summary-card summary-card--tasks">
                        <span class="card-label">Tâches assignées</span>
                        <span class="card-value">34</span>
                    </div>
                </div>
            </section>

            <!-- Section graphiques et statistiques -->
            <section class="analytics-section">
                <div class="analytics-grid">
                    <!-- Graphique circulaire des avancements -->
                    <div class="analytics-card chart-card">
                        <h3 class="card-title">Avancements des projects</h3>
                        <div class="chart-container">
                            <div class="pie-chart">
                                <svg class="chart-svg" viewBox="0 0 100 100">
                                    <circle cx="50" cy="50" r="40" fill="none" stroke="#e5e7eb" stroke-width="8"/>
                                    <circle cx="50" cy="50" r="40" fill="none" stroke="#3b82f6" stroke-width="8" 
                                            stroke-dasharray="188.5 62.8" stroke-dashoffset="0"/>
                                </svg>
                                <div class="chart-center">
                                    <span class="chart-percentage">75%</span>
                                </div>
                            </div>
                            <p class="chart-subtitle">Progression globale</p>
                        </div>
                    </div>

                    <!-- Graphique performances par chef -->
                    <div class="analytics-card performance-card">
                        <h3 class="card-title">Performance par chef de project</h3>
                        <div class="performance-bars">
                            <div class="performance-item">
                                <span class="manager-name">Chef A</span>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 85%; background-color: #3b82f6;"></div>
                                </div>
                                <span class="performance-value">85%</span>
                            </div>
                            <div class="performance-item">
                                <span class="manager-name">Chef B</span>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 70%; background-color: #f59e0b;"></div>
                                </div>
                                <span class="performance-value">70%</span>
                            </div>
                            <div class="performance-item">
                                <span class="manager-name">Chef C</span>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 92%; background-color: #10b981;"></div>
                                </div>
                                <span class="performance-value">92%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section projects critiques -->
            <section class="projects-section">
                <h3 class="section-subtitle">projects critiques</h3>
                <div class="projects-table">
                    <div class="table-header">
                        <div class="table-cell">Nom du project</div>
                        <div class="table-cell">Chef de project</div>
                        <div class="table-cell">Date butoir</div>
                        <div class="table-cell">statut</div>
                        <div class="table-cell">Progression</div>
                    </div>
                    <div class="table-row">
                        <div class="table-cell">
                            <span class="project-name">project Alpha</span>
                        </div>
                        <div class="table-cell">Marie Dubois</div>
                        <div class="table-cell">15/07/2025</div>
                        <div class="table-cell">
                            <span class="statut-badge statut-badge--critical">En retard</span>
                        </div>
                        <div class="table-cell">
                            <div class="progress-container">
                                <div class="mini-progress">
                                    <div class="mini-progress-fill" style="width: 65%"></div>
                                </div>
                                <span class="progress-text">65%</span>
                            </div>
                        </div>
                    </div>
                    <div class="table-row">
                        <div class="table-cell">
                            <span class="project-name">project Beta</span>
                        </div>
                        <div class="table-cell">Jean Martin</div>
                        <div class="table-cell">20/07/2025</div>
                        <div class="table-cell">
                            <span class="statut-badge statut-badge--warning">À risque</span>
                        </div>
                        <div class="table-cell">
                            <div class="progress-container">
                                <div class="mini-progress">
                                    <div class="mini-progress-fill" style="width: 45%"></div>
                                </div>
                                <span class="progress-text">45%</span>
                            </div>
                        </div>
                    </div>
                    <div class="table-row">
                        <div class="table-cell">
                            <span class="project-name">project Gamma</span>
                        </div>
                        <div class="table-cell">Sophie Laurent</div>
                        <div class="table-cell">25/07/2025</div>
                        <div class="table-cell">
                            <span class="statut-badge statut-badge--normal">En cours</span>
                        </div>
                        <div class="table-cell">
                            <div class="progress-container">
                                <div class="mini-progress">
                                    <div class="mini-progress-fill" style="width: 80%"></div>
                                </div>
                                <span class="progress-text">80%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>
{% endblock %}



{# test vue CHEF_PROJECT et ancienne directeur a modif ATTENTION au block debut fin body etc #}

{# <div class="dashboard-container">
		<div class="row">
			<div class="col-12 dashboard-header">
				<h1>
					<i class="fas fa-chart-line"></i>
					Dashboard Directeur
				</h1>
				<p class="text-muted">Bienvenue,
					{{ app.user.fullName }}</p>
			</div>
		</div>

		<nav class="dashboard-nav">
			<ul>
				{% if is_granted('ROLE_EMPLOYE') %}
					<li>
						<a href="{{ path('app_employe_dashboard') }}">Dashboard Employé</a>
					</li>
				{% endif %}

				{% if is_granted('ROLE_CHEF_PROJECT') %}
					<li>
						<a href="{{ path('app_CHEF_PROJECT_dashboard') }}">Dashboard Chef de project</a>
					</li>
				{% endif %}

				{% if is_granted('ROLE_DIRECTEUR') %}
					<li>
						<a href="{{ path('app_directeur_dashboard') }}" class="active">Dashboard Directeur</a>
					</li>
				{% endif %}

				{% if is_granted('ROLE_ADMIN') %}
					<li>
						<a href="{{ path('app_admin_dashboard') }}">Administration</a>
					</li>
				{% endif %}
			</ul>
		</nav>

		<div class="row mb-4">
			<div class="col-md-3">
				<div class="card stats-card bg-primary text-white">
					<div class="card-body">
						<div class="d-flex justify-content-between">
							<div>
								<h5>projects totaux</h5>
								<h2>{{ stats.total_projects ?? '0' }}</h2>
							</div>
							<div class="align-self-center">
								<i class="fas fa-project-diagram fa-2x"></i>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div class="col-md-3">
				<div class="card stats-card bg-success text-white">
					<div class="card-body">
						<div class="d-flex justify-content-between">
							<div>
								<h5>projects actifs</h5>
								<h2>{{ stats.active_projects ?? '0' }}</h2>
							</div>
							<div class="align-self-center">
								<i class="fas fa-play fa-2x"></i>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div class="col-md-3">
				<div class="card stats-card bg-info text-white">
					<div class="card-body">
						<div class="d-flex justify-content-between">
							<div>
								<h5>Employés</h5>
								<h2>{{ stats.total_employees ?? '0' }}</h2>
							</div>
							<div class="align-self-center">
								<i class="fas fa-users fa-2x"></i>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div class="col-md-3">
				<div class="card stats-card bg-warning text-white">
					<div class="card-body">
						<div class="d-flex justify-content-between">
							<div>
								<h5>Budget total</h5>
								<h2>{{ stats.total_budget ?? '0' }}
									€</h2>
							</div>
							<div class="align-self-center">
								<i class="fas fa-euro-sign fa-2x"></i>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="row">
			<div class="col-md-8">
				<div class="card content-card">
					<div class="card-header">
						<h5>
							<i class="fas fa-chart-bar"></i>
							Vue d'ensemble des projects
						</h5>
					</div>
					<div class="card-body">
						<div class="table-responsive">
							<table class="table table-hover">
								<thead>
									<tr>
										<th>project</th>
										<th>Statut</th>
										<th>Chef de project</th>
										<th>Progression</th>
										<th>Budget</th>
										<th>Actions</th>
									</tr>
								</thead>
								<tbody>
									{% if projects is defined and projects is not empty %}
										{% for project in projects %}
											<tr>
												<td>
													<strong>{{ project.titre }}</strong>
													{% if project.reference %}
														<small class="text-muted">({{ project.reference }})</small>
													{% endif %}
												</td>
												<td>
													<span class="badge bg-{{ project.statut == 'EN-COURS' ? 'success' : (project.statut == 'TERMINE' ? 'primary' : 'warning') }}">
														{{ project.statut }}
													</span>
												</td>
												<td>{{ project.chefDeproject ? project.chefDeproject.fullName : 'Non assigné' }}</td>
												<td>
													<div class="progress">
														<div class="progress-bar" style="width: {{ project.progress ?? 0 }}%">{{ (project.progress ?? 0)|round }}%</div>
													</div>
												</td>
												<td>{{ project.budget ?? 'N/A' }}</td>
												<td>
													<a href="{{ path('app_project_show', {id: project.id}) }}" class="btn btn-sm btn-outline-primary">
														<i class="fas fa-eye"></i>
													</a>
													<a href="{{ path('app_project_kanban', {id: project.id}) }}" class="btn btn-sm btn-outline-success">
														<i class="fas fa-columns"></i>
													</a>
												</td>
											</tr>
										{% endfor %}
									{% else %}
										<tr>
											<td colspan="6" class="text-center">Aucun project disponible</td>
										</tr>
									{% endif %}
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>

			<div class="col-md-4">
				<div class="card content-card">
					<div class="card-header">
						<h5>
							<i class="fas fa-chart-pie"></i>
							Distribution des projects
						</h5>
					</div>
					<div class="card-body">
						<div class="mb-4">
							<h6>Statut des projects</h6>
							<div class="progress mb-2" style="height: 25px;">
								<div class="progress-bar bg-warning" style="width: {{ stats.percent_pending ?? 0 }}%" role="progressbar">
									À faire ({{ stats.percent_pending ?? 0 }}%)
								</div>
								<div class="progress-bar bg-success" style="width: {{ stats.percent_active ?? 0 }}%" role="progressbar">
									En cours ({{ stats.percent_active ?? 0 }}%)
								</div>
								<div class="progress-bar bg-primary" style="width: {{ stats.percent_completed ?? 0 }}%" role="progressbar">
									Terminés ({{ stats.percent_completed ?? 0 }}%)
								</div>
							</div>
						</div>

						<div>
							<h6>Équipes et performance</h6>
							<ul class="list-group">
								{% if teams is defined and teams is not empty %}
									{% for team in teams %}
										<li class="list-group-item d-flex justify-content-between align-items-center">
											{{ team.name }}
											<span class="badge bg-primary rounded-pill">{{ team.project_count ?? 0 }}
												projects</span>
										</li>
									{% endfor %}
								{% else %}
									<li class="list-group-item">Aucune équipe disponible</li>
								{% endif %}
							</ul>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div> #}