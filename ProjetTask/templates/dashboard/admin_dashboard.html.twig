{% extends 'base.html.twig' %}

{% block title %}Tableau de bord | Administration
{% endblock %}

{% block body %}
<div class="container-fluid py-4">
	<h1 class="mb-4">Tableau de bord | Administration</h1>

	<div
		class="row">
		<!-- Statistiques globales -->
		<div class="col-md-3 mb-4">
			<div class="card border-0 shadow-sm">
				<div class="card-body">
					<h5 class="card-title">Projets</h5>
					<div class="d-flex justify-content-between align-items-center">
						<div class="display-4">{{ stats.projets.total }}</div>
						<i class="fas fa-project-diagram fa-2x text-primary"></i>
					</div>
					<div class="mt-3">
						<div class="d-flex justify-content-between">
							<small>En cours</small>
							<small class="text-primary">{{ stats.projets.en_cours }}</small>
						</div>
						<div class="d-flex justify-content-between">
							<small>En attente</small>
							<small class="text-warning">{{ stats.projets.en_attente }}</small>
						</div>
						<div class="d-flex justify-content-between">
							<small>Terminés</small>
							<small class="text-success">{{ stats.projets.termines }}</small>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="col-md-3 mb-4">
			<div class="card border-0 shadow-sm">
				<div class="card-body">
					<h5 class="card-title">Utilisateurs</h5>
					<div class="d-flex justify-content-between align-items-center">
						<div class="display-4">{{ stats.utilisateurs.actifs }}</div>
						<i class="fas fa-users fa-2x text-success"></i>
					</div>
					<div class="mt-3">
						<div class="d-flex justify-content-between">
							<small>Chefs de projet</small>
							<small class="text-primary">{{ stats.utilisateurs.chefs_projet }}</small>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="col-md-6 mb-4">
			<div class="card border-0 shadow-sm">
				<div class="card-body">
					<h5 class="card-title">Budget des projets</h5>
					<div
						class="budget-chart">
						<!-- Ici on pourrait intégrer un graphique avec Chart.js -->
						<table class="table table-sm">
							<thead>
								<tr>
									<th>Statut</th>
									<th>Nombre</th>
									<th>Budget total</th>
								</tr>
							</thead>
							<tbody>
								{% for stat in projets_budget %}
									<tr>
										<td>{{ stat.statut }}</td>
										<td>{{ stat.count }}</td>
										<td>{{ stat.totalBudget|number_format(2, ',', ' ') }}
											€</td>
									</tr>
								{% endfor %}
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div
		class="row">
		<!-- Projets récents -->
		<div class="col-md-6 mb-4">
			<div class="card border-0 shadow-sm">
				<div class="card-header bg-white">
					<div class="d-flex justify-content-between align-items-center">
						<h5 class="mb-0">Projets récents</h5>
						<a href="{{ path('app_project_index') }}" class="btn btn-sm btn-outline-primary">Voir tous</a>
					</div>
				</div>
				<div class="card-body">
					<div class="table-responsive">
						<table class="table table-hover">
							<thead>
								<tr>
									<th>Titre</th>
									<th>Chef de projet</th>
									<th>Statut</th>
									<th>Date</th>
								</tr>
							</thead>
							<tbody>
								{% for projet in projets_recents %}
									<tr>
										<td>
											<a href="{{ path('app_project_show', {id: projet.id}) }}">{{ projet.titre }}</a>
										</td>
										<td>
											{% if projet.Chef_Projet %}
												{{ projet.Chef_Projet.fullName }}
											{% else %}
												<span class="text-muted">Non assigné</span>
											{% endif %}
										</td>
										<td>
											<span class="badge {% if projet.statut == 'EN-COURS' %}bg-primary{% elseif projet.statut == 'TERMINE' %}bg-success{% else %}bg-warning{% endif %}">
												{{ projet.statut }}
											</span>
										</td>
										<td>{{ projet.dateCreation|date('d/m/Y') }}</td>
									</tr>
								{% endfor %}
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>

		<!-- Tâches en retard -->
		<div class="col-md-6 mb-4">
			<div class="card border-0 shadow-sm">
				<div class="card-header bg-white">
					<h5 class="mb-0">Tâches en retard</h5>
				</div>
				<div class="card-body">
					{% if taches_retard|length > 0 %}
						<div class="table-responsive">
							<table class="table table-hover">
								<thead>
									<tr>
										<th>Tâche</th>
										<th>Projet</th>
										<th>Assigné à</th>
										<th>Date butoir</th>
									</tr>
								</thead>
								<tbody>
									{% for tache in taches_retard %}
										<tr
